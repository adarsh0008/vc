import nodemailer from 'nodemailer';

export const handler = async (event) => {
    console.log('Received event:', event);  // Log the incoming event for debugging

    // Check if the body is valid and is not empty
    if (!event.body) {
        return {
            statusCode: 400,
            body: JSON.stringify({ message: 'Invalid request, no body provided.' }),
        };
    }

    let body;
    try {
        // Parse the body of the request (form data sent from the HTML page)
        body = JSON.parse(event.body);
    } catch (error) {
        console.error('Error parsing JSON:', error);
        return {
            statusCode: 400,
            body: JSON.stringify({ message: 'Invalid JSON in request body.' }),
        };
    }
 
    const { name, email, message } = body;

    // Set up the transporter using Gmail SMTP
    const transporter = nodemailer.createTransport({
        service: 'gmail',
        auth: {
            user: 'adarshitmails@gmail.com',  // Replace with your Gmail address
            pass: 'bnlc vcdk jriq jghy'       // Replace with your Gmail App password (not your normal Gmail password)
        }
    });

    // Set up email options
    const mailOptions = {
        from: 'adarshitmails@gmail.com',   // Your Gmail address
        to: 'virtualicarustech@gmail.com',    // Your email where the form data will be sent
        subject: `New message from ${name} (${email})`,
        text: `You have received a new message from your website form:\n\nName: ${name}\nEmail: ${email}\nMessage: ${message}`
    };

    try {
        // Send email
        await transporter.sendMail(mailOptions);
        return {
            statusCode: 200,
            body: JSON.stringify({
                message: 'Form submitted successfully! We will get back to you soon.',
            }),
        };
    } catch (error) {
        console.error('Error sending email:', error);
        return {
            statusCode: 500,
            body: JSON.stringify({
                message: 'There was an error sending your message. Please try again later.',
            }),
        };
    }
};


===========================================

import nodemailer from 'nodemailer';

// Create a transporter
const transporter = nodemailer.createTransport({
  service: "gmail",
  auth: {
    user: "adarshitmails@gmail.com", // Replace with your Gmail address
    pass: "bnlc vcdk jriq jghy",   // Replace with your Gmail app password
  },
});

// Define the email options
const mailOptions = {
  from: "adarshitmails@gmail.com",       // Sender address
  to: "virtualicarustech@gmail.com",  // List of recipients
  subject: "Test Email from Nodemailer", // Subject line
  text: "Hello! This is a test email sent using Nodemailer and Gmail.", // Plain text body
};

// Send the email
transporter.sendMail(mailOptions, (error, info) => {
  if (error) {
    return console.log("Error:", error);
  }
  console.log("Email sent successfully:", info.response);
});
